// 感想機能の総作成数 一つフォームが作成されるたびに加算される
// commentFormNumber(cfn)
var cfn = 1;
// アンケートの選択内容とコメントの入力内容を格納するリスト
// 例:[ ["1",あいうえお] , ["2",かきくけこ] , ...]
//var commentList = [];
// 再読み込みの復元時にこのメソッドが呼び出されるとloadがtrueになる
function createComment(left,top,load) {
	// 1つの感想フォームの固まりとしてdivタグを作成する
	// 初期状態としてドラッグ不可能にしている
	// ドラッグ終了時には灰色の枠線を消し、再びドラッグ不可能な状態に戻す
	// 選択されると赤色の枠線が表示されドラッグ可能になる'style='position: relative; left:"+left+"px; top: "+top+"px;
	var div = $('<div>')
				.attr({id:"opinion"+cfn,name:"opinion",cfn:cfn})
				.css({position:'absolute',top:top+'px',left:left+'px'})
				.draggable({
					stop:function(e,ui){
						if(presenter){
							// フォームを移動させた時に座標を上書きする
							var commentObj = {id:$(this).attr('id'),cfn:Number($(this).attr('cfn')),opinion:{top:$('#opinion'+$(this).attr('cfn')).offset().top,left:$('#opinion'+$(this).attr('cfn')).offset().left}};
							for (var i = 0; i < jsonObj["comments"].length; i++) {
								if(jsonObj["comments"][i]['cfn'] == $(this).attr('cfn')){
									jsonObj["comments"][i] = commentObj;
									break;
								}
							}
							//console.log(jsonObj);
							$(this).css({border:''}).draggable('disable');
							selectedId = [this.id,false];
						}
					}
				}).draggable('disable').selectable({
					selected:function(e,ui){
						if(presenter){
							$(this).css({border:'solid 1px red'}).draggable('enable');
							selectedId = [this.id,true];
						}
					}
				}).css({width:'325px','text-align':'center'});

	$('#comments').append(div);
	for(var i = 0;i < 2; i++){
		$('#opinion'+cfn).append(jQuery("<input type='radio' name='opinion"+cfn+"' id='opinion"+cfn+"-"+(i+1)+"' value='"+(i+1)+"'/><label for='opinion"+cfn+"-"+(i+1)+"'>"));
	}


	$('#opinion'+cfn+"-1").next().html("：分かりやすかった");
	$('#opinion'+cfn+"-2").next().html("：分かりにくかった");

	$('#opinion'+cfn).append(jQuery("<br>"));

	var textarea = $('<textarea>').attr({
		id:"comment"+cfn,
		name:"comment"+cfn,
		cols:"42.5",
		rows:"6",
		maxlength:"500",
		placeholder:"ご意見・ご感想をご記入ください"
	}).css({resize:'vertical'});

	// どのボタンが選択されたかチェックするためにボタンのnameを記録
	var name = 'opinion'+cfn;

	$('#opinion'+cfn).append(textarea);
	$('#opinion'+cfn).append(jQuery("<br>"));
	$('#opinion'+cfn).append(jQuery("<input type='button'/>").attr({value: "送信する",id: "cSubmit"+cfn}).click(function(){
		if (!$("input[name="+name+"]:checked").val()||textarea.val()=="") {
			alert("未選択または未入力です。");
		} else {
			// 感想の入力内容をサーバに送信する
			socket.emit('comment_from_client',$("input[name="+name+"]:checked").val(),textarea.val());
			// テキストエリアの入力内容を取得
			console.log($("input[name="+name+"]:checked").val(),textarea.val());
			//var tmp = [$("input[name="+name+"]:checked").val(),textarea.val()];
			//commentList.push(tmp);
			// 送信後ラジオボタンの選択とテキストエリアの入力を無効にし、送信ボタンを非表示にする
			$("input[name="+name+"]").attr('disabled', 'disabled');
			textarea.attr('disabled', 'disabled');
			$(this).css('visibility', 'hidden');
		}
	}));
	// loadがfalseの時、jsonObjにデータを記録する
	// loadがtrueの時は復元なので記録しない
	if(!load){
		var commentObj = {id:$('#opinion'+cfn).attr('id'),cfn:cfn,opinion:{top:$('#opinion'+cfn).offset().top,left:$('#opinion'+cfn).offset().left}};
		jsonObj["comments"].push(commentObj);
	}
	cfn++;
}