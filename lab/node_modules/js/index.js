$(function(){
	$(document).ready(function() {
		$('#jMenu').jMenu({
			openClick : false,
			ulWidth :'150',
			TimeBeforeOpening : 100,
			TimeBeforeClosing : 11,
			animatedText : false,
			paddingLeft: 1,
			effects : {
				effectSpeedOpen : 150,
				effectSpeedClose : 150,
				effectTypeOpen : 'slide',
				effectTypeClose : 'slide',
				effectOpen : 'swing',
				effectClose : 'swing'
			}
		});
		// サーバにjsonObjを送信し、その情報から前回の状態を復元する
		socket.emit('reload_from_client',jsonObj);
		// cookieとサーバの値を比較し、発表者かどうかを認証する
		socket.emit('cookie_from_client',getCookie('sw_javascriptauth_password'));
		// 発表者として登録されているかどうかを確認し、いなければ発表者として登録できる
		socket.emit('register_from_client');
	});

	// アンケートの選択肢の数
	$( '#spinner' ).spinner({
		max:9,
		min:1
	});

	// アンケートのダイアログ
	$( '#questionDialog' ).dialog({
		autoOpen: false,
		width: 300,
		modal: true,
		buttons: [
		{
			text: "Ok",
			click: function() {
				// left:0 top:50 の位置にアンケートフォームを作成
				createQuestion($('#spinner').spinner("value"),0,50,false);
				$( this ).dialog( "close" );
			}
		},
		{
			text: "Cancel",
			click: function() {
				$( this ).dialog( "close" );
			}
		}
		]
	});

	$('#chatForm').submit(function(e){
		socket.emit('emit_from_client',$('#msg').val());
		// 複数の値を送る時、jsonで渡す
		//socket.json.emit('emit_from_client',{
		//	msg: $('#msg').val(),
		//	name: $('#name').val()
		//});
		$('#msg').val('').focus();
		e.preventDefault();
	});

	// スライド追加ボタン
	$('#addSlide').click(function(e){
		// サーバに格納されているスライドの画像を読み込む（同期）
		socket.emit('slideload_from_client');
		e.preventDefault();
	});

	// e.preventDefaultしておかないと機能追加ボタンがaタグなのでクリックするとページが更新されてしまう
	$('#addTool').click(function(e){e.preventDefault();});

	$('#edit').click(function(e){e.preventDefault();});

	// アンケートボタン
	$('#questionForm').click(function(e){
		// 選択肢の数を設定するダイアログを表示
		$('#questionDialog').dialog("open");
		e.preventDefault();
	});

	// 感想ボタン
	$('#commentForm').click(function(e){
		// left:0 top:50 の位置に感想フォームを作成
		createComment(0,50,false);
		e.preventDefault();
	});

	// 集計ボタン
	$('#count').click(function(e){
		// アンケートの集計ダイアログを表示する（同期）
		socket.emit('countDialog_from_client');
		e.preventDefault();
	});

	// 集計ボタンのダイアログ
	$( '#countDialog' ).dialog({
		autoOpen: false,
		width: 600,
		modal: true,
		buttons: [
		{
			text: "集計",
			class: "presenterTools",
			click: function() {
				// アンケートの選択肢の数
				var choiceNum;
				// 現在表示されている（visible）アンケートの選択肢の数を取得
				$('#questions div').each(function(i){
					if($(this).css("visibility") == "visible"){
						choiceNum = $(this).children('label').length;
					}
				});
				// アンケートの集計を表示する（同期）
				socket.emit('count_from_client',choiceNum);
			}
		}
		],
		close: function() {
			// 集計ダイアログを閉じると、グラフが削除される
			$('#countDialog').children().remove();
		}
	});

	// 保存ボタン
	$('#save').click(function(e){
		// 現在の状態を保存する
		// 再読み込み時の復元のために、jsonObjの情報をサーバに保存する
		socket.emit('save_from_client',jsonObj);
		alert("現在の状態を保存しました。");
		e.preventDefault();
	});
	// 削除ボタン
	$('#remove').click(function(e){
		var user = confirm("追加したスライドやフォーム（アンケート、感想）がすべて一旦削除されますがよろしいですか？");
		if(user){
			// すべてのスライドとフォームを削除する
			removeAll();
		}
		e.preventDefault();
	});

	// 解除ボタン
	$('#release').click(function(e){
		var user = confirm(getCookie('sw_javascriptauth_password')+"さんは発表者ではなくなりますがよろしいですか？");
		if(user){
			// 発表者としての権限を解除
			socket.emit('release_from_client');
		}
		e.preventDefault();
	});

	// ヘルプボタン
	$('#help').click(function(e){
		// ヘルプダイアログを表示
		$('#helpDialog').dialog("open");
		e.preventDefault();
	});
	// ヘルプのダイアログ
	$( '#helpDialog' ).dialog({
        resizable: false,
		autoOpen: false,
		width: 750,
		height: 400,
		modal: true,
		buttons: [
		{
			text: "Ok",
			click: function() {
				$( this ).dialog( "close" );
			}
		}
		]
	});
});
