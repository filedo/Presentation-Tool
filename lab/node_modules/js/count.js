// アンケートの結果を集計し、D3.jsを用いてブラウザに棒グラフとして描画する
function count(answerList){
	var one = 0;
	var two = 0;
	var three = 0;
	var four = 0;
	var five = 0;
	var six = 0;
	var seven = 0;
	var eight = 0;
	var nine = 0;

	// アンケートの集計
	for(i = 0;i < answerList.length;i++){
		var number = answerList[i];
		switch(number){
			case '1': one++;
			break;
			case '2': two++;
			break;
			case '3': three++;
			break;
			case '4': four++;
			break;
			case '5': five++;
			break;
			case '6': six++;
			break;
			case '7': seven++;
			break;
			case '8': eight++;
			break;
			case '9': nine++;
			break;
		}
	}

	// 集計した結果をdatasetに格納
	var dataset = [
		{name: "1", count: one},
		{name: "2", count: two},
		{name: "3", count: three},
		{name: "4", count: four},
		{name: "5", count: five},
		{name: "6", count: six},
		{name: "7", count: seven},
		{name: "8", count: eight},
		{name: "9", count: nine}
	];
	var scaleX = d3.scale.linear()
        .domain([0, dataset.length]).range([0, 200]);
    var scaleY = d3.scale.linear()
        .domain([0, d3.max(dataset, function(d){return d.count;})]).range([0,180]);
    //カンバスの定義
    var canvas = d3.select("#canvas");
    var svg = canvas.append("svg")
        .attr("width",200).attr("height",200)
        .attr("shape-rendering", "crispEdges");    //アンチエイリアスを無効にする．
    //データ駆動のドローイング
    //棒グラフ部
    svg.selectAll("rect")
        .data(dataset).enter().append("rect")
        .attr("x", function(d, i){return scaleX(i) + 25/dataset.length})
        .attr("y", function(d, i){return 190 - scaleY(d.count)})
        .attr("width", function(d, i){return 150/dataset.length})
        .attr("height", function(d, i){return scaleY(d.count)})
        .attr("fill", "blue");
    //名前の出力
    svg.selectAll("text.name")//便宜上クラスを設定しているが，ここでは特に意味はない．
        .data(dataset).enter().append("text")
        .attr("x", function(d, i){return scaleX(i) + 100/dataset.length})
        .attr("y", function(d, i){return 200})
        .attr("text-anchor", "end")
        .attr("font-weight", "bold")
        .attr("font-family", "selif")
        .text(function(d, i){return d.name})
        .attr("fill", "black");
    //点数の出力
    svg.selectAll("text.count")//上でのtext要素の挿入結果を無視するためにクラスを追加している．
        .data(dataset).enter().append("text")
        .attr("x", function(d, i){return scaleX(i) + 100/dataset.length})
        .attr("y", function(d, i){return 210 - scaleY(d.count)})
        .attr("text-anchor", "middle")
        .attr("font-weight", "bold")
        .attr("font-family", "selif")
        .text(function(d, i){return d.count})
        .attr("fill", "white");
}