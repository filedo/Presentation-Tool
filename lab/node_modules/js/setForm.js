/**
フォームをスライドごとにセットする方法
1.キーと値の配列を作る
2.フォームをセットした時、フォームidと現在のスライドidをキーと値として関連づける
3.スライドを移動した時、現在のスライドidを取得し、配列を全て検索してスライドidと関連づけられているフォームidが存在するか調べる
4.存在すればそのフォームを表示させる
5.それ以外のフォームは非表示にする
**/

//1.キーと値の連想配列を作る （変数名が思いつかない）
var slideIdAndFormId = {};
function setForm(__selectedId){
	// 2.フォームをセットした時、キーを現在のスライドid、値をフォームidとして関連づける
	var key = $('#slide').find(":last").attr("zIndex");
	var value = $('#'+__selectedId[0]).attr("id");
	// セットするフォームのidと一致するidをjsonObjから探し、
	// 見つかればその連想配列に新しくslideIndexという要素を追加し、keyをセットする
	// フォームの情報にセットされたスライドのindexが追加される（どのフォームがどのスライドにセットされているかが分かる）
	// 再読み込み時にはidとslideIndexをslideIdAndFormIdに追加すれば復元できるはず slideIdAndFormId[slideIndex]=id;
	// 感想フォーム
	if($('#'+__selectedId[0]).attr('name')=='opinion'){
		for (var i = 0; i < jsonObj["comments"].length; i++) {
			if(jsonObj["comments"][i]['id'] == value){
				jsonObj["comments"][i].slideIndex = Number(key);
				//console.log(jsonObj);
				break;
			}
		}
	}
	// アンケートフォーム
	else if($('#'+__selectedId[0]).attr('name')=='question'){
		for (var i = 0; i < jsonObj["questions"].length; i++) {
			if(jsonObj["questions"][i]['id'] == value){
				jsonObj["questions"][i].slideIndex = Number(key);
				//console.log(jsonObj);
				break;
			}
		}
	}
	// この仕様では、もしkeyが存在していれば、valueが上書きされるので1枚のスライドに2つ以上フォームを設定できない
	slideIdAndFormId[key] = value;
	$('#'+__selectedId[0]).css({border:''}).draggable().draggable('disable');

	// フォームが設定されたのでselectedIdを初期化
	selectedId = ["id",false];
}